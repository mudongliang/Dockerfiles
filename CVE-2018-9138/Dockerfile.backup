FROM debian:stretch

RUN apt-get update
RUN apt-get install -y --force-yes texinfo build-essential wget clang 


WORKDIR /root
RUN wget https://ftp.gnu.org/gnu/binutils/binutils-2.29.tar.gz
RUN tar -xvf binutils-2.29.tar.gz 

#RUN wget -O /tmp/llvm-snapshot.gpg.key http://apt.llvm.org/llvm-snapshot.gpg.key
#RUN apt-key add /tmp/llvm-snapshot.gpg.key
#
#RUN bash -c 'echo "deb http://apt.llvm.org/stretch/ llvm-toolchain-stretch-5.0 main" >> /etc/apt/sources.list.d/llvm.list'
#
#RUN bash -c 'echo "deb-src http://apt.llvm.org/stretch/ llvm-toolchain-stretch-5.0 main" >> /etc/apt/sources.list.d/llvm.list'
#
#RUN apt-get update
#RUN apt-get install -y clang-5.0 clang-tools-5.0 clang-5.0-doc libclang-common-5.0-dev libclang-5.0-dev libclang1-5.0 libclang1-5.0-dbg libllvm5.0 libllvm5.0-dbg lldb-5.0 llvm-5.0 llvm-5.0-dev llvm-5.0-doc llvm-5.0-examples llvm-5.0-runtime clang-format-5.0 python-clang-5.0 libfuzzer-5.0-dev


WORKDIR /root/binutils-2.29/
RUN CC=clang CFLAGS="-g -fsanitize=address" LDFLAGS="-fsanitize=address" ./configure
RUN make
WORKDIR /root/binutils-2.29/binutils/
RUN wget https://sourceware.org/bugzilla/attachment.cgi?id=10917 -O poc
RUN ./cxxfilt < poc
